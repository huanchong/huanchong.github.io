<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222"/>


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2"/>

<link rel="stylesheet" href="/css/main.css?v=6.7.0"/>


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.7.0',
    sidebar: {"position":"left","width":350,"display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Huanchong&#39;s Blog">
<meta property="og:url" content="http://huanchong.top/index.html">
<meta property="og:site_name" content="Huanchong&#39;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Huanchong&#39;s Blog">






  <link rel="canonical" href="http://huanchong.top/"/>



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Huanchong's Blog</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Huanchong's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br/>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br/>Tags</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br/>Categories</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br/>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/04/15/nodeJS-2/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/15/nodeJS-2/" class="post-title-link" itemprop="url">nodeJS-2</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-15 13:31:26" itemprop="dateCreated datePublished" datetime="2019-04-15T13:31:26+08:00">2019-04-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-17 16:42:03" itemprop="dateModified" datetime="2019-04-17T16:42:03+08:00">2019-04-17</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="核心模块"><a href="#核心模块" class="headerlink" title="核心模块"></a>核心模块</h2><h3 id="全局对象与全局变量"><a href="#全局对象与全局变量" class="headerlink" title="全局对象与全局变量"></a>全局对象与全局变量</h3><ul>
<li>node环境中，全局对象为global；浏览器环境中，全局对象时window</li>
<li>所有全局变量均挂载在全局对象上，作为全局对象的属性，其中包含：<ul>
<li>显式定义全局对象的属性</li>
<li>隐式定义的变量(没有定义直接赋值的变量)</li>
<li>这里建议使用 var、let、const 定义变量以避免引入全局变量，因为全局变量会污染 命名空间，提高代码的耦合风险。<h4 id="常用的全局变量"><a href="#常用的全局变量" class="headerlink" title="常用的全局变量"></a>常用的全局变量</h4>process：描述当前 Node.js 进程状态 的对象，提供了一个与操作系统的简单接口</li>
</ul>
</li>
<li>process.argv是命令行参数数组，第一个元素是 node，第二个元素是脚本文件名，从第三个元素开始每个元素是一个运行参数</li>
<li>process.nextTick(callback)将callback放入异步micro task队列中，如果callback的执行时间需要很长，则通过这个方式可以不阻塞当前主线程<br>console:控制台标准输出</li>
<li>console.log()常规输出，也可以使用类似c语言printf()命令的占位符输出console.log(‘%d year’, 1993)</li>
<li>console.error()输出错误</li>
<li>console.trace()输出当前调用栈</li>
</ul>
<h3 id="事件驱动-events模块"><a href="#事件驱动-events模块" class="headerlink" title="事件驱动 events模块"></a>事件驱动 events模块</h3><p>事件发射与监听器：events.EventEmitter 对象</p>
<ul>
<li>EventEmitter.on(event, listener) 为指定事件注册一个监听器，接受一个字符串event 和一个回调函数listener</li>
<li>EventEmitter.emit(event, [arg1], [arg2], […]) 发射 event 事件，传递若干可选参数到事件监听器的参数表</li>
<li>EventEmitter.once(event, listener) 为指定事件注册一个单次监听器，即监听器最多只会触发一次，触发后立刻解除该监听器</li>
<li>EventEmitter.removeListener(event, listener) 移除指定事件的某个监听器，listener 必须是该事件已经注册过的监听器</li>
<li>EventEmitter.removeAllListeners([event]) 移除所有事件的所有监听器， 如果指定 event，则移除指定事件的所有监听器<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"><span class="keyword">var</span> emitter = <span class="keyword">new</span> events.EventEmitter();</span><br><span class="line">emitter.on(<span class="string">'event'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg1, arg2</span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'listener1'</span>, arg1, arg2);</span><br><span class="line">&#125;);</span><br><span class="line">emitter.on(<span class="string">'event'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">arg1, arg2</span>) </span>&#123; <span class="built_in">console</span>.log(<span class="string">'listener2'</span>, arg1, arg2);</span><br><span class="line">&#125;);</span><br><span class="line">emitter.emit(<span class="string">'someEvent'</span>, <span class="string">'hello'</span>, <span class="string">'world'</span>);</span><br><span class="line"><span class="comment">// listener1 hello world</span></span><br><span class="line"><span class="comment">// listener2 hello world</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>大多数时候我们不会直接使用 EventEmitter，而是在对象中继承它。包括 fs、net、 http 在内的，只要是支持事件响应的核心模块都是 EventEmitter 的子类，<strong>模块的实例对象可以直接使用on()方法监听事件</strong></p>
</blockquote>
<h3 id="文件系统-fs模块"><a href="#文件系统-fs模块" class="headerlink" title="文件系统 fs模块"></a>文件系统 fs模块</h3><ul>
<li>fs.readFile() 异步读取文件内容</li>
<li>fs.readFileSync() 同步读取文件内容</li>
<li>fs.open() 打开文件</li>
<li>fs.read() 读取文件(从指定的文件描述符 fd 中读取数据并写入 buffer 指向的缓冲区对象)，需要先执行fs.open()打开文件后，在其回调函数中使用fs.read().一般来说，除非必要，否则不要使用这种方式读取文件，因为它要求你手动管理缓冲区 和文件指针，尤其是在你不知道文件大小的时候，这将会是一件很麻烦的事情。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.open(<span class="string">'content.txt'</span>, <span class="string">'r'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.error(err);</span><br><span class="line">        <span class="keyword">return</span>; </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(<span class="number">8</span>);</span><br><span class="line">fs.read(fd, buf, <span class="number">0</span>, <span class="number">8</span>, <span class="literal">null</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, bytesRead, buffer</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123; </span><br><span class="line">        <span class="built_in">console</span>.error(err); </span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'bytesRead: '</span> + bytesRead);</span><br><span class="line">        <span class="built_in">console</span>.log(buffer);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// bytesRead: 8</span></span><br><span class="line"><span class="comment">// &lt;Buffer 54 65 78 74 20 e6 96 87&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="HTTP-模块"><a href="#HTTP-模块" class="headerlink" title="HTTP 模块"></a>HTTP 模块</h3><p>HTTP模块封装了一个HTTP服务器与HTTP客户端</p>
<h4 id="HTTP服务器（基于http-Server对象实现）"><a href="#HTTP服务器（基于http-Server对象实现）" class="headerlink" title="HTTP服务器（基于http.Server对象实现）"></a>HTTP服务器（基于http.Server对象实现）</h4><p>http.createServer()会创建一个http.Server实例对象<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123; </span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;); </span><br><span class="line">    res.write(<span class="string">'&lt;h1&gt;Node.js&lt;/h1&gt;'</span>);</span><br><span class="line">    res.end(<span class="string">'&lt;p&gt;Hello World&lt;/p&gt;'</span>);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"HTTP server is listening at port 3000."</span>);</span><br></pre></td></tr></table></figure></p>
<p>http.createServer的回调函数中的两个参数 req 和res，分别是 http.ServerRequest和http.ServerResponse 的实例，表示请求和响应信息</p>
<h5 id="http-ServerRequest-是-HTTP-请求的信息，所有的业务逻辑都是根据请求传递的内容展开的，所以是后端开发者最关注的内容"><a href="#http-ServerRequest-是-HTTP-请求的信息，所有的业务逻辑都是根据请求传递的内容展开的，所以是后端开发者最关注的内容" class="headerlink" title="http.ServerRequest 是 HTTP 请求的信息，所有的业务逻辑都是根据请求传递的内容展开的，所以是后端开发者最关注的内容"></a>http.ServerRequest 是 HTTP 请求的信息，所有的业务逻辑都是根据请求传递的内容展开的，所以是后端开发者最关注的内容</h5><p>包含一些常用属性：<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g25hbftx9rj21760j2gpa.jpg" alt=""><br>http.ServerRequest的事件：</p>
<ul>
<li>data :当请求体数据到来时，该事件被触发。该事件提供一个参数 chunk，表示接 收到的数据。如果该事件没有被监听，那么请求体将会被抛弃。该事件可能会被调 用多次</li>
<li>end :当请求体数据传输完成时，该事件被触发，此后将不会再有数据到来</li>
<li>close: 用户当前请求结束时，该事件被触发</li>
</ul>
<h6 id="获取GET请求内容：使用url-parse来解析get请求中url后面的参数"><a href="#获取GET请求内容：使用url-parse来解析get请求中url后面的参数" class="headerlink" title="获取GET请求内容：使用url.parse来解析get请求中url后面的参数"></a>获取GET请求内容：使用url.parse来解析get请求中url后面的参数</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>); </span><br><span class="line"><span class="keyword">var</span> url = <span class="built_in">require</span>(<span class="string">'url'</span>); </span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123; </span><br><span class="line">    res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;); </span><br><span class="line">    res.end(util.inspect(url.parse(req.url, <span class="literal">true</span>))); <span class="comment">// util.inspect是将对象转换成字符串的工具函数</span></span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h6 id="获取POST请求内容"><a href="#获取POST请求内容" class="headerlink" title="获取POST请求内容"></a>获取POST请求内容</h6><p>使用http.ServerRequest的data事件收集post请求体内容，然后使用querystring.parse来解析post请求传过来的内容<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>); </span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> post = <span class="string">''</span>;</span><br><span class="line">    req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>) </span>&#123; </span><br><span class="line">        post += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    req.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        post = querystring.parse(post); </span><br><span class="line">        res.end(util.inspect(post));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;).listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p> 不要在真正的生产应用中使用上面这种简单的方法来获取 POST 请 求，因为它有严重的效率问题和安全问题，这只是一个帮助你理解的示例。</p>
</blockquote>
<h5 id="http-ServerResponse-是返回给客户端的信息，决定了用户最终能看到的结果"><a href="#http-ServerResponse-是返回给客户端的信息，决定了用户最终能看到的结果" class="headerlink" title="http.ServerResponse 是返回给客户端的信息，决定了用户最终能看到的结果"></a>http.ServerResponse 是返回给客户端的信息，决定了用户最终能看到的结果</h5><p>三个重要的成员函数，用于返回响应头、响应内容以及结束 请求:</p>
<ul>
<li>response.writeHead(statusCode, [headers]):向请求的客户端发送响应头。 statusCode 是 HTTP 状态码，如 200 (请求成功)、404 (未找到)等。headers 是一个类似关联数组的对象，表示响应头的每个属性。该函数在一个请求内最多只 能调用一次，如果不调用，则会自动生成一个响应头</li>
<li>response.write(data, [encoding]):向请求的客户端发送响应内容。data 是 一个 Buffer 或字符串，表示要发送的内容。如果 data 是字符串，那么需要指定 encoding 来说明它的编码方式，默认是 utf-8。在 response.end 调用之前， response.write 可以被多次调用</li>
<li>response.end([data], [encoding]):结束响应，告知客户端所有发送已经完 成。当所有要返回的内容发送完毕的时候，该函数 必须 被调用一次。它接受两个可 选参数，意义和 response.write 相同。如果不调用该函数，客户端将永远处于 等待状态</li>
</ul>
<h4 id="HTTP-客户端（作为客户端向服务器发起请求）"><a href="#HTTP-客户端（作为客户端向服务器发起请求）" class="headerlink" title="HTTP 客户端（作为客户端向服务器发起请求）"></a>HTTP 客户端（作为客户端向服务器发起请求）</h4><ul>
<li><p>http.request(options, callback) 发起 HTTP 请求</p>
<ul>
<li>option 是 一个类似关联数组的对象，表示请求的参数，callback 是请求的回调函数</li>
<li>callback 传递一个参数，为http.ClientResponse的实例</li>
<li>http.request 返回一个http.ClientRequest的实例<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"><span class="keyword">var</span> querystring = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"><span class="keyword">var</span> contents = querystring.stringify(&#123;</span><br><span class="line">name: <span class="string">'byvoid'</span>,</span><br><span class="line">email: <span class="string">'byvoid@byvoid.com'</span>,</span><br><span class="line">address: <span class="string">'Zijing 2#, Tsinghua University'</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">host: <span class="string">'www.byvoid.com'</span>,</span><br><span class="line">path: <span class="string">'/application/node/post.php'</span>, <span class="attr">method</span>: <span class="string">'POST'</span>,</span><br><span class="line">headers: &#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">        <span class="string">'Content-Length'</span> : contents.length</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> req = http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123; res.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">req.write(contents);</span><br><span class="line">req.end(); <span class="comment">//  不要忘了通过 req.end() 结束请求，否则服务器将不会收到信息</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>http.get(options, callback) get请求的简化版，唯一的区别在于http.get 自动将请求方法设为了 GET 请求，同时<strong>不需要手动调用 req.end()</strong></p>
</li>
</ul>
<h5 id="http-ClientRequest-对象（http-request-返回的实例对象）"><a href="#http-ClientRequest-对象（http-request-返回的实例对象）" class="headerlink" title="http.ClientRequest 对象（http.request()返回的实例对象）"></a>http.ClientRequest 对象（http.request()返回的实例对象）</h5><p>对象含有的方法：</p>
<ul>
<li>write()服务器发送请求体</li>
<li>end()写结束以后必须调用 end 函数以通知服务器，否则请求无效</li>
</ul>
<h5 id="http-ClientResponse-对象（http-request-回调函数中的参数为该实例对象）"><a href="#http-ClientResponse-对象（http-request-回调函数中的参数为该实例对象）" class="headerlink" title="http.ClientResponse 对象（http.request()回调函数中的参数为该实例对象）"></a>http.ClientResponse 对象（http.request()回调函数中的参数为该实例对象）</h5><p>提供三个事件：</p>
<ul>
<li>data 数据达到是触发</li>
<li>end 数据传输结束后触发</li>
<li>close 连接结束后触发<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g25puxxjy2j216q09sgn9.jpg" alt=""></li>
</ul>
<p>三个特殊的函数：</p>
<ul>
<li>response.setEncoding([encoding]):设置默认的编码，当 data 事件被触发时，数据将会以 encoding 编码。默认值是 null，即不编码，以 Buffer 的形式存储。常用编码为 utf8</li>
<li>response.pause():暂停接收数据和发送事件，方便实现下载功能</li>
<li>response.resume():从暂停的状态中恢复</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/04/14/nodeJS-1/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/14/nodeJS-1/" class="post-title-link" itemprop="url">nodeJS</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-14 12:49:38" itemprop="dateCreated datePublished" datetime="2019-04-14T12:49:38+08:00">2019-04-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-15 13:31:40" itemprop="dateModified" datetime="2019-04-15T13:31:40+08:00">2019-04-15</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="node-js简介"><a href="#node-js简介" class="headerlink" title="node.js简介"></a>node.js简介</h3><ul>
<li>node.js不是一种独立语言，是一个可以让js在服务器端运行的平台</li>
<li>区别与传统语言平台依靠多线程来实现高并发的设计思路，node采用单线程、异步式I/O、事件驱动式的程序设计模型</li>
<li>node.js使用的JavaScript引擎为V8引擎，还使用了高效的 <strong>libev 和 libeio 库支持事件驱动和异步式 I/O</strong> 来代替传统平台的多线程模式，带来性能的提升（传统多线程模式对于 高并发的访问，一方面线程长期阻塞等待，另一方面为了应付新请求而不断增加线程，因此 会浪费大量系统资源，同时线程的增多也会占用大量的 CPU 时间来处理内存上下文切换， 而且还容易遭受低速连接攻击。）</li>
<li>有别于php等语言，在使用php构建web服务时，必须外部依赖一个Nginx、Apache等http服务器，然后通过http服务区的模块加载或CGI调用，才能将php的执行结果呈现给用户；而node.js内置了http服务器模块，无需再额外搭建</li>
<li>node.js可以调用c/c++代码，对于性能要求比较高的模块可以使用c/c++来实现<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g2242fwxptj20wm0mign9.jpg" alt=""></li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g224ukryq5j20l00gcdgz.jpg" alt=""></p>
<p>node.js只在第一次运行时会读取文件内容，以后都会直接访问内存，也就是当文件实时改动时，不会触发重新编译文件内容，所以需要使用<strong>supervisor、pm2</strong>等工具，对node服务进行实时管理</p>
<h3 id="异步式I-O-与事件驱动式编程"><a href="#异步式I-O-与事件驱动式编程" class="headerlink" title="异步式I/O 与事件驱动式编程"></a>异步式I/O 与事件驱动式编程</h3><h4 id="阻塞与线程"><a href="#阻塞与线程" class="headerlink" title="阻塞与线程"></a>阻塞与线程</h4><blockquote>
<p>什么是阻塞(block)呢?线程在执行中如果遇到磁盘读写或网络通信(统称为 I/O 操作)， 通常要耗费较长的时间，这时操作系统会剥夺这个线程的 CPU 控制权，使其暂停执行，同 时将资源让给其他的工作线程，这种线程调度方式称为 阻塞。当 I/O 操作完毕时，操作系统 将这个线程的阻塞状态解除，恢复其对CPU的控制权，令其继续执行。这种 I/O 模式就是通 常的同步式 I/O(Synchronous I/O)或阻塞式 I/O (Blocking I/O)  </p>
</blockquote>
<blockquote>
<p>异步式 I/O (Asynchronous I/O)或非阻塞式 I/O (Non-blocking I/O)则针对 所有 I/O 操作不采用阻塞的策略。<strong>当线程遇到 I/O 操作时，不会以阻塞的方式等待 I/O 操作 的完成或数据的返回，而只是将 I/O 请求发送给操作系统，继续执行下一条语句</strong>。当操作 系统完成 I/O 操作时，以<strong>事件的形式</strong>通知执行 I/O 操作的线程，线程会在特定时候处理这个 事件。为了处理异步 I/O，线程必须有事件循环，不断地检查有没有未处理的事件，依次予 以处理。</p>
</blockquote>
<h4 id="多线程与单线程的比较："><a href="#多线程与单线程的比较：" class="headerlink" title="多线程与单线程的比较："></a>多线程与单线程的比较：</h4><p>对于需要长时间计算的I/O处理操作</p>
<ul>
<li><p>多线程模式：如果想实现高并发，就必须开启多个线程<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g225j31u3mj20qu0oiaci.jpg" alt=""></p>
</li>
<li><p>单线程模式：I/O异步，通过事件方式通知线程，即可完成高并发<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g225kaxr3sj20po0swju4.jpg" alt=""></p>
</li>
</ul>
<p>单线程事件驱动的异步式 I/O 比传统的多线程阻塞式 I/O 究竟好在哪里呢?</p>
<ul>
<li>简而言之， 异步式 I/O 就是少了多线程的开销。对操作系统来说，创建一个线程的代价是十分昂贵的， 需要给它分配内存、列入调度，同时在线程切换的时候还要执行内存换页，CPU 的缓存被 清空，切换回来的时候还要重新从内存中读取信息，破坏了数据的局部性。(基于多线程的模型也有相应的解决方案，如轻量级线程(lightweight thread)等。事件驱动的单线程异步模型与多线 程同步模型到底谁更好是一件非常有争议的事情，因为尽管消耗资源，后者的吞吐率并不比前者低)</li>
<li>异步式编程的缺点在于不符合人们一般的程序设计思维，存在回调地狱的情况（使用async、promise等编写方式）<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g225r057v1j216k0ceada.jpg" alt=""></li>
</ul>
<h3 id="node-js的事件循环机制"><a href="#node-js的事件循环机制" class="headerlink" title="node.js的事件循环机制"></a>node.js的事件循环机制</h3><blockquote>
<p>Node.js 程序由事件循环开始，到事件循环结束，所有的逻辑都是事件的回调函数，所以 Node.js 始终在事件循环中，程序入口就是 事件循环第一个事件的回调函数。事件的回调函数在执行的过程中，可能会发出 I/O 请求或 直接发射(emit)事件，执行完毕后再返回事件循环，事件循环会检查事件队列中有没有未 处理的事件，直到程序结束.</p>
<p>与其他语言不同的是，Node.js 没有显式的事件循环，类似 Ruby 的 EventMachine::run() 的函数在 Node.js中是不存在的。Node.js的事件循环对开发者不可见，由libev库实现。libev支持多种类型的事件，如 ev_io、ev_timer、ev_signal、ev_idle 等，在 Node.js 中均被 EventEmitter 封装。libev 事件循环的每一次迭代，在 Node.js 中就是一次 Tick，libev 不 断检查是否有活动的、可供检测的事件监听器，直到检测不到时才退出事件循环，进程结束</p>
</blockquote>
<p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g22cm3qesvj20ps0s4q59.jpg" alt=""></p>
<h3 id="npm包管理器"><a href="#npm包管理器" class="headerlink" title="npm包管理器"></a>npm包管理器</h3><h4 id="创建npm包"><a href="#创建npm包" class="headerlink" title="创建npm包"></a>创建npm包</h4><p>Node.js 根 据 CommonJS 规范实现了包机制，开发了 npm来解决包的发布和获取需求。<br>使用如下命令初始化创建npm包<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure></p>
<p>Node.js 的包是一个目录，其中包含一个 JSON 格式的包说明文件 package.json。严格符 合 CommonJS 规范的包应该具备以下特征:</p>
<ul>
<li>package.json 必须在包的顶层目录下; <ul>
<li>作为npm包的描述性文件，其中常用的字段:</li>
<li><strong>main</strong>:作为包模块的入口（Node.js 在调用某个包时，会首先检查包中 package.json 文件的 main 字段，将其作为包的接口模块，如果 package.json 或 main 字段不存在，会尝试寻找 index.js 或 index.node 作 为包的接口）</li>
<li>name:包的名称</li>
<li>description:包的简要说明</li>
<li>version:版本字符串</li>
<li>keywords:关键字数组，通常用于搜索</li>
<li>maintainers:维护者数组，每个元素要包含 name、email (可选)、web (可选)字段</li>
<li>contributors:贡献者数组，格式与maintainers相同。包的作者应该是贡献者数组的第一个元素</li>
<li>bugs:提交bug的地址，可以是网址或者电子邮件地址</li>
<li>licenses:许可证数组</li>
<li>repositories:仓库托管地址数组</li>
<li>dependencies:包的依赖，一个关联数组，由包名称和版本号组成</li>
</ul>
</li>
<li>二进制文件应该在 bin 目录下;</li>
<li>JavaScript 代码应该在 lib 目录下;</li>
<li>文档应该在 doc 目录下;</li>
<li>单元测试应该在 test 目录下。<br>Node.js 对包的要求并没有这么严格，只要顶层目录下有 package.json，并符合一些规范 即可。当然为了提高兼容性，我们还是建议你在制作包的时候，严格遵守 CommonJS 规范</li>
</ul>
<h4 id="本地模式与全局模式"><a href="#本地模式与全局模式" class="headerlink" title="本地模式与全局模式"></a>本地模式与全局模式</h4><p>全局模式的安装：</p>
<blockquote>
<p>npm [install/i] -g [package_name]</p>
</blockquote>
<blockquote>
<p>为什么要使用全局模式呢?多数时候并不是因为许多程序都有可能用到它，为了减少多 重副本而使用全局模式，而是因为本地模式不会注册 PATH 环境变量。举例说明，我们安装 supervisor 是为了在命令行中运行它，譬如直接运行 supervisor script.js，这时就需要在 PATH 环境变量中注册 supervisor。npm 本地模式仅仅是把包安装到 node_modules 子目录下，其中 的 bin 目录没有包含在 PATH 环境变量中，不能直接在命令行中调用。而当我们使用全局模 式安装时，npm 会将包安装到系统目录，譬如 /usr/local/lib/node_modules/，同时 package.json 文 件中 bin 字段包含的文件会被链接到 /usr/local/bin/。/usr/local/bin/ 是在PATH 环境变量中默认 定义的，因此就可以直接在命令行中运行 supervisor script.js命令了</p>
</blockquote>
<p>使用全局模式安装的包并不能直接在 JavaScript 文件中用 require 获 得，因为 require 不会搜索 /usr/local/lib/node_modules/</p>
<p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g22dbja4ptj217809emyq.jpg" alt=""><br>区别：</p>
<ul>
<li>当我们要把某个包作为工程运行时的一部分时，通过本地模式获取</li>
<li>如果要 在命令行下使用，则使用全局模式安装</li>
</ul>
<h4 id="创建全局链接"><a href="#创建全局链接" class="headerlink" title="创建全局链接"></a>创建全局链接</h4><blockquote>
<p>npm 提供了一个有趣的命令 npm link，它的功能是在本地包和全局包之间创建符号链 接。我们说过使用全局模式安装的包不能直接通过 require 使用，但通过 npm link命令 可以打破这一限制。举个例子，我们已经通过 npm install -g express 安装了 express， 5 这时在工程的目录下运行命令:<br><strong>npm link express</strong><br>./node_modules/express -&gt; /usr/local/lib/node_modules/express<br>我们可以在 node_modules 子目录中发现一个指向安装到全局的包的符号链接。通过这种方法，我们就可以把全局包当本地包来使用了</p>
</blockquote>
<blockquote>
<p>除了将全局的包链接到本地以外，使用 npm link命令还可以将本地的包链接到全局。 使用方法是在包目录( package.json 所在目录)中运行 npm link 命令。如果我们要开发 一个包，利用这种方法可以非常方便地在不同的工程间进行调试和测试</p>
</blockquote>
<h5 id="具体使用案例："><a href="#具体使用案例：" class="headerlink" title="具体使用案例："></a>具体使用案例：</h5><p>现在有两个模块，npm-link-module为我们开发的npm包；npm-link-test为我们要使用上面的npm包来做测试<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd npm-link-module  //进入开发的npm包目录里</span><br><span class="line">npm link //将本地的包链接到全局</span><br><span class="line"></span><br><span class="line">cd npm-link-test  //进入到测试项目中</span><br><span class="line">npm link npm-link-module  //将全局包npm-link-module 链接到本地node_modules路径下，这样本地就可以使用require()引用了</span><br></pre></td></tr></table></figure></p>
<h4 id="包的发布"><a href="#包的发布" class="headerlink" title="包的发布"></a>包的发布</h4><ul>
<li>npm adduser 创建账号</li>
<li>npm whoami 命令测验是否已经取得了账号</li>
<li>npm publish 发布包 </li>
<li>通过<a href="https://www.npmjs.com/" target="_blank" rel="noopener">https://www.npmjs.com/</a> 去搜索自己发布的包</li>
<li>日后有更新时，更改package.json中的version版本，重新npm publish即可</li>
<li>npm unpublish 取消已发布的包</li>
</ul>
<h3 id="node命令行调试-调试功能由-V8-提供"><a href="#node命令行调试-调试功能由-V8-提供" class="headerlink" title="node命令行调试(调试功能由 V8 提供)"></a>node命令行调试(调试功能由 V8 提供)</h3><p>使用node debug xxx.js 即可开启调试模式<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g22ef0cf5zj216s0x8dmr.jpg" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/03/05/chrome-extensions/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/03/05/chrome-extensions/" class="post-title-link" itemprop="url">写chrome插件前必须要知道的</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-03-05 15:29:08" itemprop="dateCreated datePublished" datetime="2019-03-05T15:29:08+08:00">2019-03-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-14 18:20:41" itemprop="dateModified" datetime="2019-03-14T18:20:41+08:00">2019-03-14</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>浏览器插件本质上就是利用前端的html\css\javascript等技术，借用浏览器对外提供的API，实现各种不同的功能</p>
<h3 id="插件组成"><a href="#插件组成" class="headerlink" title="插件组成"></a>插件组成</h3><p>首先先看一下我们要开发的插件的各个文件组成  </p>
<p>manifest.json :我们在项目的根文件必须要有一个命名为manifest.json的文件，它是整个插件的功能入口，用来告诉浏览器插件的一些基本信息，及需要加载和执行的资源文件等，里面包含一些必填项：</p>
<ul>
<li>name 插件的名字</li>
<li>version 插件版本</li>
<li>manifest_version manifest的版本</li>
<li><p>description 插件的描述(选填)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"hello extension"</span>,</span><br><span class="line">    <span class="string">"description"</span>: <span class="string">"Base Level Extension"</span>,</span><br><span class="line">    <span class="string">"version"</span>: <span class="string">"1.0"</span>,</span><br><span class="line">    <span class="string">"manifest_version"</span>: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>icons 在扩展程序管理界面，呈现的图标，可以设置不同的尺寸的选项，用来适配不同的场景</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"icons"</span>: &#123;</span><br><span class="line">        <span class="string">"16"</span>: <span class="string">"images/extension_icon16.png"</span>,</span><br><span class="line">        <span class="string">"32"</span>: <span class="string">"images/extension_icon32.png"</span>,</span><br><span class="line">        <span class="string">"48"</span>: <span class="string">"images/extension_icon48.png"</span>,</span><br><span class="line">        <span class="string">"128"</span>: <span class="string">"images/extension_icon128.png"</span></span><br><span class="line">      &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>background 在扩展程序被开启时，会首先触发执行background 选项中指定的js资源，并且一直存在于扩展程序的整个生命周期，直到扩展程序被关闭或者删除，background一直被用来做任务和状态的控制管理工作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// scripts 子选项指定了需要执行的js文件的路径及文件名</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"background"</span>: &#123;</span><br><span class="line">        <span class="string">"scripts"</span>:[<span class="string">"background.js"</span>],</span><br><span class="line">        <span class="string">"persistent"</span>: <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>background.js 通常最外层使用监听事件<code>chrome.runtime.onInstalled.addListener(()=&gt;{})</code>初始化插件，监听插件安装成功后，会触发对应的逻辑开始工作</p>
<ul>
<li>permissions 属性值为一个数组，申请chrome API的权限，只有在这个选项中申请了才能使用（比如通过 XMLHttpRequest 跨域请求数据、访问浏览器选项卡（tabs）、获取当前活动选项卡（activeTab）、浏览器通知（notifications）、设置插件激活规则（declarativeContent）、类似localStorage的存储（storage）等）<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"permissions"</span>: [</span><br><span class="line">        <span class="string">"http://xxx.com/api"</span></span><br><span class="line">        <span class="string">"tabs"</span>,</span><br><span class="line">        <span class="string">"activeTab"</span>,</span><br><span class="line">        <span class="string">"notifications"</span>,</span><br><span class="line">        <span class="string">"declarativeContent"</span>,</span><br><span class="line">        <span class="string">"storage"</span></span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="与用户实现UI交互的功能主要有两个：browser-action、page-action-两者选择其中一个"><a href="#与用户实现UI交互的功能主要有两个：browser-action、page-action-两者选择其中一个" class="headerlink" title="与用户实现UI交互的功能主要有两个：browser_action、page_action 两者选择其中一个"></a>与用户实现UI交互的功能主要有两个：browser_action、page_action 两者选择其中一个</h4><ul>
<li><p>browser_action 提供的功能面向所有网站，插件图标一直是激活的状态</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"browser_action"</span>: &#123;</span><br><span class="line">      <span class="string">"default_popup"</span>: <span class="string">"popup.html"</span>        <span class="comment">// 指定click插件图标时，展示的页面</span></span><br><span class="line">      <span class="string">"default_icon"</span>: <span class="string">"images/icon.png"</span>, <span class="comment">// 指定浏览器工具栏展示的插件的图标 </span></span><br><span class="line">      <span class="string">"default_title"</span>: <span class="string">"display tooltip"</span> <span class="comment">// 当鼠标悬浮在插件图片上方时，展示的文字，叫tooltip；如果没有这个配置选项，则悬浮时显示menifest.json中的name选项值</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>page_action 只针对对应目标网站提供的功能，插件会在background页设置激活插件的规则，只有满足条件的网页的插件才是激活的，其他网站插件是不可用的，插件的icon是灰的<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0s0byu0w2j20mw01y3yx.jpg" alt=""><br>在<code>background script</code>里，<code>chrome.runtime.onInstalled.addListener(()=&gt;{})</code>初始化中使用<code>chrome.declarativeContent</code>定义插件被激活的规则</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"page_action"</span>:&#123;</span><br><span class="line">        <span class="string">"default_popup"</span>: <span class="string">"popup.html"</span>, <span class="comment">// 指定click插件图标时，展示的页面</span></span><br><span class="line">        <span class="string">"default_icon"</span>: <span class="string">"hello_extension.png"</span> <span class="comment">// 指定浏览器工具栏展示的插件的图标 </span></span><br><span class="line">        <span class="string">"default_title"</span>: <span class="string">"display tooltip"</span></span><br><span class="line">&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">    chrome.runtime.onInstalled.addListener(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Replace all rules ...</span></span><br><span class="line">    chrome.declarativeContent.onPageChanged.removeRules(<span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// With a new rule ...</span></span><br><span class="line">    chrome.declarativeContent.onPageChanged.addRules([</span><br><span class="line">        &#123;</span><br><span class="line">        <span class="comment">// That fires when a page's URL contains a 'g' ...</span></span><br><span class="line">        conditions: [</span><br><span class="line">            <span class="keyword">new</span> chrome.declarativeContent.PageStateMatcher(&#123;</span><br><span class="line">            pageUrl: &#123; <span class="attr">urlContains</span>: <span class="string">'g'</span> &#125;, <span class="comment">//url的内容中包含字母g的，插件才会被激活</span></span><br><span class="line">            &#125;)</span><br><span class="line">        ],</span><br><span class="line">        <span class="comment">// And shows the extension's page action.</span></span><br><span class="line">        actions: [ <span class="keyword">new</span> chrome.declarativeContent.ShowPageAction() ]</span><br><span class="line">        &#125;</span><br><span class="line">    ]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="popup-html"><a href="#popup-html" class="headerlink" title="popup.html"></a>popup.html</h4><p>popup.html 是使用browser_action或者page_action 指定的default_popup选项，表示点击插件图标会触发的html资源，其与普通的html页面的区别就是不能使用内联script，其他都一样<br>it can contain links to stylesheets and script tags, but does not allow inline JavaScript.</p>
<h4 id="Content-Script-对当前web页面注入扩展程序代码，也就是在当前web页面的上下文环境中，可以访问页面的DOM信息并且修改DOM，具有操作Chrome-API的权限，并且可以把信息传递给父级插件"><a href="#Content-Script-对当前web页面注入扩展程序代码，也就是在当前web页面的上下文环境中，可以访问页面的DOM信息并且修改DOM，具有操作Chrome-API的权限，并且可以把信息传递给父级插件" class="headerlink" title="Content Script 对当前web页面注入扩展程序代码，也就是在当前web页面的上下文环境中，可以访问页面的DOM信息并且修改DOM，具有操作Chrome API的权限，并且可以把信息传递给父级插件"></a>Content Script 对当前web页面注入扩展程序代码，也就是在当前web页面的上下文环境中，可以访问页面的DOM信息并且修改DOM，具有操作Chrome API的权限，并且可以把信息传递给父级插件</h4><ol>
<li>content script工作在一个独立的空间，它使得不会访问和调用web page或者其他content script中定义的变量和函数，两者唯一共享的是DOM</li>
<li><p>Content Script与Page action 或Browser action通信的方式是通过传递Message的方式，正确的机制应该是：</p>
<ul>
<li>Page action 或Browser action 中的js使用<code>chrome.tabs.sendMessage()</code>发布一个请求信息，传递出去当前的tab页id及其他信息</li>
<li><p>注意：从Page action 或Browser action发布消息到Content Script必须用<code>chrome.tabs.sendMessage()</code>，从Content Script发布简单的信息到Page action 或Browser action 可以使用<code>chrome.runtime.sendMessage()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.tabs.sendMessage(</span><br><span class="line">    tabs[<span class="number">0</span>].id, <span class="comment">//当前激活的tab页id</span></span><br><span class="line">    &#123;<span class="attr">greeting</span>: <span class="string">"hello"</span>&#125;, <span class="comment">//需要传递的信息</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123; <span class="comment">//用来接收反馈的回调函数</span></span><br><span class="line">    <span class="built_in">console</span>.log(response.farewell);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Content Script完成初始化，设置<code>chrome.runtime.onMessage().addListener()</code>监听事件，等待另一侧请求信息的发布</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(</span><br><span class="line"> <span class="function"><span class="keyword">function</span>(<span class="params">request, sender, sendResponse</span>) </span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(sender.tab ?</span><br><span class="line">                 <span class="string">"from a content script:"</span> + sender.tab.url :</span><br><span class="line">                 <span class="string">"from the extension"</span>);</span><br><span class="line">     <span class="keyword">if</span> (request.greeting == <span class="string">"hello"</span>)</span><br><span class="line">     sendResponse(&#123;<span class="attr">farewell</span>: <span class="string">"goodbye"</span>&#125;);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Content Script将信息通过Message发布订阅的方式，发布出去</p>
</li>
<li>Page action 或Browser action 中的js<code>chrome.tabs.sendMessage()</code>最后一个参数是一个回调函数，用来接收另一侧反馈回来的数据，最后同步到UI上<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome.tabs.sendMessage()</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Content script有两种注入方式：编程式动态注入、声明式注入</p>
</li>
<li><p>编程式动态注入：获取<code>activeTab</code>权限后，使用<code>chrome.tabs.executeScript()</code>来注入js代码片段，使用<code>chrome.tabs.insertCSS()</code>注入css代码片段</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//manifest.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"My extension"</span>,</span><br><span class="line">  ...</span><br><span class="line">  <span class="string">"permissions"</span>: [</span><br><span class="line">    <span class="string">"activeTab"</span></span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>  在Page action 或Browser action 中的js中实行编程式动态注入content script，其访问和更改的就是web page上的DOM属性</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onMessage.addListener(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">message, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (message == “changeColor”)&#123;</span><br><span class="line">      chrome.tabs.executeScript(&#123;</span><br><span class="line">        code: <span class="string">'document.body.style.backgroundColor="orange"'</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;);</span><br><span class="line"> <span class="comment">// 你也可以注入一个文件</span></span><br><span class="line"> chrome.runtime.onMessage.addListener(</span><br><span class="line">  <span class="function"><span class="keyword">function</span>(<span class="params">message, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (message == “runContentScript”)&#123;</span><br><span class="line">      chrome.tabs.executeScript(&#123;</span><br><span class="line">        file: <span class="string">'contentScript.js'</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
<ol start="5">
<li><p>声明式注入，在manifest.json中使用content_scripts来定义</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"name"</span>: <span class="string">"My extension"</span>,</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">"content_scripts"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">"matches"</span>: [<span class="string">"http://*.nytimes.com/*"</span>],</span><br><span class="line">        <span class="string">"css"</span>: [<span class="string">"myStyles.css"</span>],</span><br><span class="line">        <span class="string">"js"</span>: [<span class="string">"contentScript.js"</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    ],</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>matches：必填 数组，用来匹配注入Content Script的页面地址。可以使用通配符来指代：’*’指代任意长度字符；’?’指代单个字符</li>
<li>css：选填 数组，在页面的任何DOM创建和展示之前，按照数组中定义的顺序，依次注入</li>
<li>js：选填 数组，按照数组中定义的顺序，依次注入</li>
<li>run_at：Content Script注入的时机<ul>
<li>如果是document_start, 文件将在所有CSS加载完毕，但是没有创建DOM并且没有运行任何脚本的时候注入</li>
<li>如果是document_end，则文件将在创建完DOM之后，但还没有加载类似于图片或frame等的子资源前立刻注入</li>
<li>如果是document_idle，浏览器会在document_end和发出window.onload事件之间的某个时机注入。具体的时机取决与文档加载的复杂度，为加快页面加载而优化</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"content_scripts"</span> : [&#123;</span><br><span class="line">      <span class="string">"matches"</span> : [<span class="string">"*://*/*"</span>],</span><br><span class="line">      <span class="string">"js"</span> : [<span class="string">"content.js"</span>, <span class="string">"jquery.js"</span>],</span><br><span class="line">      <span class="string">"css"</span> : [<span class="string">"style.css"</span>],</span><br><span class="line">      <span class="string">"run_at"</span> : <span class="string">"document_end"</span></span><br><span class="line">  &#125;],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>options_page 设置插件的选项页面，配置了此选项后，在插件上鼠标右键时，会有一个‘选项’按钮，点击后会进入options_page对应的页面</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"options_page"</span>:<span class="string">"options.html"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0s6ny6sqgj20hs0bagm8.jpg" alt=""></p>
</li>
<li><p>chrome_url_overrides 设置可替换的chrome默认页面</p>
<ul>
<li>newtab：新建标签时打开的页面</li>
<li>bookmarks：书签页面</li>
<li>history：历史记录<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"chrome_url_overrides"</span>:&#123;</span><br><span class="line">      <span class="string">"newtab"</span>: <span class="string">"newTab.html"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0s8jgnb5ej2122068q3h.jpg" alt=""></p>
<h3 id="常用到的Chrome-API"><a href="#常用到的Chrome-API" class="headerlink" title="常用到的Chrome API"></a>常用到的Chrome API</h3><h4 id="chrome-tabs"><a href="#chrome-tabs" class="headerlink" title="chrome.tabs"></a>chrome.tabs</h4></li>
</ul>
<ol>
<li>chrome.tabs.create(object createProperties, function callback)<br>创建新的标签。注： 无需请求manifest的标签权限，此方法也可以被使用。<br><strong>Parameters</strong><br>createProperties ( object )<ul>
<li>windowId ( optional integer )<br>创建新标签的目标窗口。默认是当前窗口 。</li>
<li>index ( optional integer )<br>标签在窗口中的位置。 值在零至标签数量之间。</li>
<li>url ( optional string )<br>标签导航的初始页面。完整的URL 必须包含一个前缀 (如 ‘<a href="http://www.google.com&#39;" target="_blank" rel="noopener">http://www.google.com&#39;</a>, 不能写为 ‘<a href="http://www.google.com&#39;)。" target="_blank" rel="noopener">www.google.com&#39;)。</a> 相对 URL则与扩展所在的页面相对， 默认值为新标签页面。</li>
<li>selected ( optional boolean )<br>标签是否成为选中标签。默认为true。</li>
<li>pinned ( optional boolean )<br>标签是否被固定。默认值为false。</li>
<li>callback ( optional function )</li>
</ul>
</li>
</ol>
<pre><code>Callback function
回调 参数 应该如下定义：

function(Tab tab) {...};
tab ( Tab )
所创建的标签的细节，包含新标签的ID。
</code></pre><p><br></p>
<ol start="2">
<li><p>chrome.tabs.executeScript(integer tabId, object details, function callback)<br>向页面注入JavaScript 脚本执行<br><strong>Parameters</strong></p>
<ol>
<li>tabId ( optional integer )<br>运行脚本的标签ID；默认为当前窗口所选中的标签。</li>
<li>details ( object )<br>要执行的脚本内容，可选code或者file，但不能同时选两者。<ul>
<li>code ( optional string )<br>要执行的脚本代码。</li>
<li>file ( optional string )<br>要执行的脚本文件。</li>
<li>allFrames ( optional boolean )<br>true的时候，给所有frame执行脚本。默认为false，只给顶级frame执行脚本。</li>
</ul>
</li>
<li>callback ( optional function )<br>所有脚本执行后会被调用的回调。</li>
</ol>
</li>
<li><p>chrome.tabs.query(object queryInfo, function callback)<br>获取经过特定过滤条件筛选的标签页信息，如果没有特定过滤条件则是获取所有标签页信息</p>
<ol>
<li><p>queryInfo 为特定的属性，用来对标签页进行过滤。<br> 常用的属性有：（所有属性均为boolean值）</p>
<ul>
<li>active 标签在他们的窗口中是否是激活状态</li>
<li><p>currentWindow 标签是否在当前窗口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">chrome.tabs.query(&#123;</span><br><span class="line">    active:<span class="literal">true</span>,</span><br><span class="line">    currentWindow:<span class="literal">true</span></span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">tabs</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>callback 是获取到特定标签页信息后的回调函数，参数为标签的信息</p>
<h4 id="chrome-contextMenus-当前页面，选中内容后右键展示的内容"><a href="#chrome-contextMenus-当前页面，选中内容后右键展示的内容" class="headerlink" title="chrome.contextMenus 当前页面，选中内容后右键展示的内容"></a>chrome.contextMenus 当前页面，选中内容后右键展示的内容</h4><p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0whlgg7g5j20ba0eiwl4.jpg" alt=""></p>
</li>
</ol>
</li>
<li>在manifest.json中设置权限<code>{&quot;permissions&quot;: [&quot;contextMenus&quot;, &quot;storage&quot;]}</code></li>
<li>放在background.js中，初始化之后的回调函数中，使用<code>chrome.contextMenus.create({})</code>创建内容目录<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">chrome.runtime.onInstalled.addListener(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="comment">//...</span></span><br><span class="line">     chrome.contextMenus.create(&#123;</span><br><span class="line">         <span class="string">"id"</span>: <span class="string">"sampleContextMenu"</span>,</span><br><span class="line">         <span class="string">"title"</span>: <span class="string">"Sample Context Menu"</span>,</span><br><span class="line">         <span class="string">"contexts"</span>: [<span class="string">"selection"</span>]</span><br><span class="line">     &#125;);</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h3><ol>
<li>进入扩展程序管理界面 chrome://extensions</li>
<li>开启’开发者模式’<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0s8xyee82j227k060t9t.jpg" alt=""></li>
<li>可以选择’加载已解压的扩展程序’，将本地开发目录上传上去即可</li>
<li>可以使用’打包扩展程序’，生成.ctx后缀的扩展程序，就可以发布到google应用市场了<h3 id="插件调试"><a href="#插件调试" class="headerlink" title="插件调试"></a>插件调试</h3><h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4></li>
</ol>
<ul>
<li>每次刷新页面，都会执行browser_action或page_action 指定的popup.html资源</li>
<li>background指定的js资源只在插件安装时执行，之后就一直存在进程中，不会重复执行<h4 id="调试步骤"><a href="#调试步骤" class="headerlink" title="调试步骤"></a>调试步骤</h4></li>
</ul>
<ol>
<li>在浏览器工具栏右键插件图标<br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0s91fijjaj20hs0ba3z4.jpg" alt=""></li>
<li>点击’审查弹出内容’，进入控制台</li>
<li>切换到Source栏，即可看到browser_action或page_action 指定的资源，设置断点</li>
<li>切换到Console栏，输入location.reload()，发现原有的页面重新进行了加载，同时browser_action或page_action 指定的资源也重新执行了一遍，并在设置的断点处停下来，等待debug</li>
</ol>
<h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://developer.chrome.com/extensions" target="_blank" rel="noopener">chrome扩展程序</a><br><a href="https://www.zhihu.com/question/20179805" target="_blank" rel="noopener">如何从零写一个Chrome扩展</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/02/25/understanding-es6-12/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/25/understanding-es6-12/" class="post-title-link" itemprop="url">ES6-Modules</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-25 14:44:01" itemprop="dateCreated datePublished" datetime="2019-02-25T14:44:01+08:00">2019-02-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-04 15:11:45" itemprop="dateModified" datetime="2019-03-04T15:11:45+08:00">2019-03-04</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0qs1z3avzj216w0lggpe.jpg" alt=""></p>
<h3 id="模块的导入导出"><a href="#模块的导入导出" class="headerlink" title="模块的导入导出"></a>模块的导入导出</h3><ol>
<li><p>导出export</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="number">111</span> <span class="comment">//导出基本类型</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;&#125; <span class="comment">// 导出类</span></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span></span>&#123;&#125; <span class="comment">// 导出函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params">num1, num2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1*num2</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> &#123; multiply &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>导入import</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; num &#125; <span class="keyword">from</span> <span class="string">'./example.js'</span> <span class="comment">//导入单个模块</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Example <span class="keyword">from</span> <span class="string">'./example.js'</span> <span class="comment">//导入所有模块并合并在一个命名空间对象上</span></span><br></pre></td></tr></table></figure>
<p>注：</p>
<ul>
<li><p>当代码执行到import导入语句时，会根据引用的路径，执行导出模块的代码，也就是完成导出模块的实例化，并且将该模块实例保存在内存中，同一应用的任何模块引用此导出模块时，都会复用已在内存中的模块实例，而不会重新进行导出模块的实例化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多次import同一模块，只在实例化一次模块，之后都会复用这个模块实例</span></span><br><span class="line"><span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br><span class="line"><span class="keyword">import</span> &#123;multiply&#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br><span class="line"><span class="keyword">import</span> &#123;add&#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入的常量是导出变量的只读引用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; num &#125; <span class="keyword">from</span> <span class="string">'./example.js'</span> <span class="comment">// 不能给num重新赋值，同时当example.js中的num值变化时，这里的num也会跟着变化</span></span><br><span class="line">num = <span class="string">'Tom'</span> <span class="comment">//error报错</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>重命名导入和导出名称</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">num1, num2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> num1 + num2</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 导出模块</span></span><br><span class="line"><span class="keyword">export</span> &#123;sum <span class="keyword">as</span> add&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 引入模块</span></span><br><span class="line"><span class="keyword">import</span> &#123;add <span class="keyword">as</span> sum &#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导出模块默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//法一</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="comment">//法二</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> add</span><br><span class="line"><span class="comment">//法三</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">multiply</span>(<span class="params"></span>)</span>&#123;&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;add <span class="keyword">as</span> <span class="keyword">default</span>, multiply&#125; <span class="comment">//导出多个，并设置默认导出</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入模块默认值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sum <span class="keyword">from</span> <span class="string">'./example.js'</span> <span class="comment">//不适用大括号&#123;&#125;，名字也可以随便取</span></span><br><span class="line"><span class="keyword">import</span> sum ,&#123; multiply &#125; <span class="keyword">from</span> <span class="string">'./example.js'</span> <span class="comment">// 既有默认值sum，也有非默认值，非默认值要放到&#123;&#125;中，并且名称要和导出模块的名称保持一致</span></span><br><span class="line"><span class="comment">//上面的写法等价于下面的写法</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="keyword">default</span> <span class="keyword">as</span> sum, multiply&#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>导入再导出</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br><span class="line"><span class="keyword">export</span> &#123; add &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//合并到一句的写法：</span></span><br><span class="line"><span class="keyword">export</span> &#123; add &#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br><span class="line"><span class="comment">//从example.js中导入add，并命名为sum导出</span></span><br><span class="line"><span class="keyword">export</span> &#123; add <span class="keyword">as</span> sum &#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>无绑定的导入(比如css文件等，不需要明确指定引入的模块内容)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">'./style.css'</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="Web浏览器中模块执行的顺序"><a href="#Web浏览器中模块执行的顺序" class="headerlink" title="Web浏览器中模块执行的顺序"></a>Web浏览器中模块执行的顺序</h3><p>新型浏览器针对script标签增加type=’module’的属性，来支持模块化语法的资源引入</p>
<ol>
<li>遇到<code>&lt;script type=&#39;module&#39;&gt;</code> 的标签时，会立即下载对应的js资源，下载完后会解析js，遇到import语句会取请求对应的资源</li>
<li>下载和解析<code>&lt;script type=&#39;module&#39;&gt;</code> 资源的时候，并不会影响html接下来的解析</li>
<li>在html解析加载完成之前只会做下载和解析工作，不会执行js代码，执行js的顺序会严格按照<code>&lt;script&gt;</code>显式引入和import隐式引入的顺序来依次执行<h4 id="案例分析："><a href="#案例分析：" class="headerlink" title="案例分析："></a>案例分析：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">'module'</span> src=<span class="string">'module1.js'</span>&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">'module'</span>&gt;</span><br><span class="line">    <span class="keyword">import</span> &#123;sum&#125; <span class="keyword">from</span> <span class="string">'./example.js'</span></span><br><span class="line">    <span class="keyword">let</span> result = sum(<span class="number">1</span>,<span class="number">2</span>) </span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script type='module' src='module2.js'&gt;&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>正确的顺序：</p>
<ol>
<li>下载并解析module1.js</li>
<li>递归下载并解析在module1.js中使用import引入的资源</li>
<li>解析内联模块</li>
<li>递归下载并解析内联模块中使用import引入的资源example.js</li>
<li>下载并解析module2.js<br>在html解析完成之前，都不会有任何JS执行，当html解析完成之后，DOMContentLoaded触发之前，开始执行js，执行js的顺序如下：</li>
<li>递归执行module1.js中引入的资源(按照import的顺序依次执行)</li>
<li>执行module1.js</li>
<li>递归执行内联模块import的资源</li>
<li>执行内联模块的代码</li>
<li>递归执行module2.js中引入的资源(按照import的顺序依次执行)</li>
<li>执行module2.js</li>
</ol>
<p>注意：<code>&lt;script type=&#39;module&#39;&gt;&lt;/script&gt;</code>采取的就是defer属性的方式，因此设不设置defer没有任何影响；但是设置async属性后，会<strong>按照async的模式，下载解析完，并且所有包含的import资源也都下载解析后按照引入顺序立即执行js</strong><br><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0iwdd6h68j227m0j642z.jpg" alt=""></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/02/24/understanding-es6-11/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/24/understanding-es6-11/" class="post-title-link" itemprop="url">ES6-Promise</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-24 15:06:44" itemprop="dateCreated datePublished" datetime="2019-02-24T15:06:44+08:00">2019-02-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-04 15:11:38" itemprop="dateModified" datetime="2019-03-04T15:11:38+08:00">2019-03-04</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0qs1z3avzj216w0lggpe.jpg" alt=""></p>
<h3 id="Promise与异步编程"><a href="#Promise与异步编程" class="headerlink" title="Promise与异步编程"></a>Promise与异步编程</h3><h4 id="创建一个待执行状态的Promise"><a href="#创建一个待执行状态的Promise" class="headerlink" title="创建一个待执行状态的Promise"></a>创建一个待执行状态的Promise</h4><p>new Promise()会立即执行，因此如果需要在合适的位置创建Promise，可以使用一个函数进行包装，合适的位置进行调用<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">readFile</span>(<span class="params">fileName</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//异步操作</span></span><br><span class="line">        fs.readFile(fileName, (err, contents)=&gt; &#123;</span><br><span class="line">            <span class="comment">//读取错误时</span></span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                reject(err)</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//读取成功时</span></span><br><span class="line">            resolve(contents)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> file = readFile(<span class="string">'readme.txt'</span>)</span><br><span class="line"><span class="comment">// 同时监听成功或失败</span></span><br><span class="line">file.then(<span class="function"><span class="params">data</span> =&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h4 id="直接返回一个已执行状态的Promise对象"><a href="#直接返回一个已执行状态的Promise对象" class="headerlink" title="直接返回一个已执行状态的Promise对象"></a>直接返回一个已执行状态的Promise对象</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line"><span class="built_in">Promise</span>.reject()</span><br></pre></td></tr></table></figure>
<ul>
<li>传递给Promise.resolve()的参数，如果是一个Promise对象，则会原样返回，如果不是一个Promise对象，针对非Promise的thenable对象，会做进一步包装，将其转换成Promise对象再返回（基本类型的值也会被自动转换成Promise对象）</li>
<li><p>非Promise的thenable对象：具有接受resolve、reject参数的then()方法的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> thenable = &#123;</span><br><span class="line">    then(resolve,reject)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'enter thenable'</span>)</span><br><span class="line">        resolve(<span class="number">42</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> p1 = <span class="built_in">Promise</span>.resolve(thenable)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'before then'</span>)</span><br><span class="line">p1.then(<span class="function"><span class="params">data</span> =&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">before then</span></span><br><span class="line"><span class="comment">enter thenable</span></span><br><span class="line"><span class="comment">42</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<p>上例中<br>1.程序按顺序执行，遇到<code>Promise.resolve(thenable)</code>时会把thenable中的then()中的异步函数放入microtask队列中，等主程序执行完后调用</p>
<ol start="2">
<li>执行<code>console.log(&#39;before then&#39;)</code></li>
<li>执行p1.then()这里，监听p1的状态，一旦由pending变为resolve或reject，便将其放入microtask队列中，在主程序执行完后执行</li>
<li>因此先打印<code>before then</code>，然后再打印<code>enter thenable</code>，最后是<code>42</code></li>
</ol>
</li>
</ul>
<h4 id="then-、catch-执行完后都会返回一个Promise对象，如果没有显式指定return，则会返回一个默认的Promise"><a href="#then-、catch-执行完后都会返回一个Promise对象，如果没有显式指定return，则会返回一个默认的Promise" class="headerlink" title="then()、catch()执行完后都会返回一个Promise对象，如果没有显式指定return，则会返回一个默认的Promise"></a>then()、catch()执行完后都会返回一个Promise对象，如果没有显式指定return，则会返回一个默认的Promise</h4><h4 id="响应多个Promise"><a href="#响应多个Promise" class="headerlink" title="响应多个Promise"></a>响应多个Promise</h4><ol>
<li><p>Promise.all([, , ,])参数是一个可迭代的对象(常用数组)，每个元素都是Promise对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'p1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'p2'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> p3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'p3'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> p4 = <span class="built_in">Promise</span>.all([p1, p2, p3])</span><br><span class="line">p4.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Array</span>.isArray(value)) <span class="comment">//true</span></span><br><span class="line">    <span class="built_in">console</span>.log(value)  <span class="comment">//["p1", "p2", "p3"]</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p><code>Promise.all([]).then()</code>then()中的参数是一个数组，成员是你传入的多个Promise对象中resolve的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'p1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="string">'p2'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> p3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'p3'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">let</span> p4 = <span class="built_in">Promise</span>.all([p1, p2, p3])</span><br><span class="line">p4.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">Array</span>.isArray(value)) <span class="comment">//true</span></span><br><span class="line">    <span class="built_in">console</span>.log(value)  <span class="comment">//["p1", "p2", "p3"]</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">'err'</span>,err)</span><br><span class="line">     &#125;</span><br><span class="line"> )</span><br></pre></td></tr></table></figure>
<p>如果Promise对象中触发reject状态，则会立即触发<code>Promise.all([]).catch()</code>catch()中的参数是触发reject()返回的值</p>
</li>
<li><p>Promise.race([, , ,]) 多个Promise对象竞赛，谁先触发状态变化，立刻停止</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'p1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"> <span class="keyword">let</span> p2 = <span class="built_in">Promise</span>.resolve(<span class="string">'p2'</span>)</span><br><span class="line"> <span class="keyword">let</span> p3 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">     resolve(<span class="string">'p3'</span>)</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="keyword">let</span> p4 = <span class="built_in">Promise</span>.race([p1, p2, p3])</span><br><span class="line"> p4.then(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="built_in">console</span>.log(value)  </span><br><span class="line"> &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line"> <span class="built_in">console</span>.log(<span class="string">'err'</span>,err)</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="comment">// p1</span></span><br></pre></td></tr></table></figure></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/02/24/understanding-es6-10/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/24/understanding-es6-10/" class="post-title-link" itemprop="url">ES6-Array</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-24 13:42:09" itemprop="dateCreated datePublished" datetime="2019-02-24T13:42:09+08:00">2019-02-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-04 15:11:34" itemprop="dateModified" datetime="2019-03-04T15:11:34+08:00">2019-03-04</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0qs1z3avzj216w0lggpe.jpg" alt=""></p>
<h3 id="对数组功能的增强"><a href="#对数组功能的增强" class="headerlink" title="对数组功能的增强"></a>对数组功能的增强</h3><h4 id="数组的创建"><a href="#数组的创建" class="headerlink" title="数组的创建"></a>数组的创建</h4><ol>
<li><p>Array.of()<br>数组构造器new Array()创建数组时，因为传递参数的个数与类型不同，会出现怪异的行为，因此引进了Array.of()方法创建数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> items = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">2</span>) <span class="comment">//如果只有一个参数，并且是数值型，new Array()构造器就把参数理解成为数组的长度，所以元素都为undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(items[<span class="number">0</span>]) <span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(items[<span class="number">1</span>]) <span class="comment">//undefined</span></span><br><span class="line"></span><br><span class="line"> items = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">2</span>,<span class="number">1</span>) <span class="comment">//如果参数超过1个，则new Array()构造器就把参数理解成为数组的元素</span></span><br><span class="line"> <span class="built_in">console</span>.log(items[<span class="number">0</span>]) <span class="comment">//2</span></span><br><span class="line"><span class="built_in">console</span>.log(items[<span class="number">1</span>])  <span class="comment">//1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//所以这里作为对参数理解的统一，使用Array.of()都会把参数理解成为元素</span></span><br><span class="line">items = <span class="built_in">Array</span>.of(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">console</span>.log(items[<span class="number">0</span>]) <span class="comment">//2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Array.from()<br>将类数组对象(具有数值类型的索引+length长度属性，比如DOM的NodeList)转换成数组类型<br>传统的比较快捷的方法是使用slice</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.slice.call(arrayLike)</span><br></pre></td></tr></table></figure>
<p>ES6提供的解决方法Array.from()，支持将<strong>类数组对象、可迭代对象(包含Symbol.iterator属性)</strong>转换成数组类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.from(arrayLike)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="数组实例的新方法"><a href="#数组实例的新方法" class="headerlink" title="数组实例的新方法"></a>数组实例的新方法</h4><ol>
<li><p>find()\findIndex() 根据过滤条件返回想要的第一个满足条件的元素值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> numbers = [<span class="number">12</span>,<span class="number">20</span>,<span class="number">33</span>,<span class="number">45</span>]</span><br><span class="line"><span class="keyword">let</span> value = numbers.find(<span class="function"><span class="params">value</span> =&gt;</span> value&gt;<span class="number">30</span>)</span><br><span class="line"><span class="keyword">let</span> index = numbers.findIndex(<span class="function"><span class="params">value</span> =&gt;</span> value&gt;<span class="number">30</span>)</span><br><span class="line"><span class="built_in">console</span>.log(value) <span class="comment">//33</span></span><br><span class="line"><span class="built_in">console</span>.log(index) <span class="comment">//2</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>fill()数组元素的赋值填充，第一个必填参数为想要赋新值的元素，支持指定第二、第三个参数表示赋值开始和结束的位置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line">arr.fill(<span class="number">1</span>) <span class="comment">//将元素全部重新赋值</span></span><br><span class="line"><span class="built_in">console</span>.log(arr.toString()) <span class="comment">//1,1,1,1</span></span><br><span class="line">arr.fill(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arr.toString()) <span class="comment">//1,0,0,0</span></span><br><span class="line">arr.fill(<span class="number">10</span>,<span class="number">1</span>,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">console</span>.log(arr.toString()) <span class="comment">//1,10,10,0</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>copyWithin()允许在数组内部复制自身的元素</p>
<h4 id="类型化数组"><a href="#类型化数组" class="headerlink" title="类型化数组"></a>类型化数组</h4><p>不是严格意义上的数组，主要是为JS提供快速按位计算的能力，fill()\copyWithin()方法都是基于此创建的，平时使用的场景比较少，感兴趣的可以继续了解下</p>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/02/22/understanding-es6-9/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/22/understanding-es6-9/" class="post-title-link" itemprop="url">ES6-Class</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-22 10:54:41" itemprop="dateCreated datePublished" datetime="2019-02-22T10:54:41+08:00">2019-02-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-04 15:11:24" itemprop="dateModified" datetime="2019-03-04T15:11:24+08:00">2019-03-04</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0qs1z3avzj216w0lggpe.jpg" alt=""></p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在ES6之前，官方都不支持类的语法，很多第三方类库都通过模拟实现了类似类的用法，最终ES6引入了类</p>
<h3 id="类的介绍"><a href="#类的介绍" class="headerlink" title="类的介绍"></a>类的介绍</h3><h4 id="类的声明"><a href="#类的声明" class="headerlink" title="类的声明"></a>类的声明</h4><h5 id="ES6之前的写法：称为自定义类型"><a href="#ES6之前的写法：称为自定义类型" class="headerlink" title="ES6之前的写法：称为自定义类型"></a>ES6之前的写法：称为自定义类型</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line">Person.prototype.sayName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="ES6的写法："><a href="#ES6的写法：" class="headerlink" title="ES6的写法："></a>ES6的写法：</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name <span class="comment">//自有属性</span></span><br><span class="line">    &#125;</span><br><span class="line">    sayName()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> Person(<span class="string">'Tom'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(person.sayName()) <span class="comment">//Tom</span></span><br><span class="line"><span class="built_in">console</span>.log(person <span class="keyword">instanceof</span> Person) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(person <span class="keyword">instanceof</span> <span class="built_in">Object</span>) <span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> Person) <span class="comment">//function</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> Person.sayName) <span class="comment">//undefined</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">typeof</span> Person.prototype.sayName) <span class="comment">//function</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>console.log(typeof Person) //function</code> 通过打印结果可以看到，ES6对类的声明类似ES5自定义类型写法的语法糖，本质上class定义的Person仍然是一个函数</li>
<li><code>console.log(typeof Person.sayName) //undefined  console.log(typeof Person.prototype.sayName) //function</code> 通过打印结果可以看到，ES6类中声明的方法实际也是挂载到原型上的，这个ES5自定义类型中定义的方法是一样的</li>
</ul>
<p>类表达式：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> Person = <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name <span class="comment">//自有属性</span></span><br><span class="line">    &#125;</span><br><span class="line">    sayName()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//具名类表达式</span></span><br><span class="line"><span class="keyword">let</span> Person = <span class="class"><span class="keyword">class</span> <span class="title">Person2</span></span>&#123;</span><br><span class="line">    <span class="comment">//构造器</span></span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name <span class="comment">//自有属性</span></span><br><span class="line">    &#125;</span><br><span class="line">    sayName()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">**这里的Person2只能在类的方法中被访问到**</span><br></pre></td></tr></table></figure></p>
<h5 id="使用ES6声明类的优势"><a href="#使用ES6声明类的优势" class="headerlink" title="使用ES6声明类的优势"></a>使用ES6声明类的优势</h5><ol>
<li>类声明不会被提升，类声明类似于let，在程序执行到达类声明之前，是处于暂时性死区中的，访问会报错。ES5中的函数定义法，函数是可以被提升到当前作用域顶部的</li>
<li>类声明中的代码强制在严格模式下运行’use strict’，且不能退出</li>
<li>类的所有方法不可枚举，ES5的自定义类型只能通过Object.defineProperty()来定义属性描述符规定其不可枚举</li>
<li>调用类生成实例时，必须使用new关键词，会自动调用类中的构造器constructor函数。不适用new 调用类会报错；这是自定义类型的函数是没办法规避的</li>
<li>类的方法不能使用new 关键词调用，会抛出错误</li>
<li>试图在类的方法中重写类名(相当于const类名)，会抛出错误；在类外部可以重写类名(相当于let类名)</li>
</ol>
<h4 id="类是一等公民"><a href="#类是一等公民" class="headerlink" title="类是一等公民"></a>类是一等公民</h4><p>在编程中，能被当做值来使用的就称为一等公民，也就是说，就像函数那样，能够作为函数的参数、函数的返回值、能用来给变量赋值等操作<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createClass</span>(<span class="params">classDef</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> classDef()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> obj = createClass(<span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">    sayHi()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Hi'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">obj.sayHi() <span class="comment">//Hi</span></span><br></pre></td></tr></table></figure></p>
<h4 id="类的访问器属性"><a href="#类的访问器属性" class="headerlink" title="类的访问器属性"></a>类的访问器属性</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = name</span><br><span class="line">    &#125;</span><br><span class="line">    get name()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'getter'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.value</span><br><span class="line">    &#125;</span><br><span class="line">    set name(name)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'setter'</span>)</span><br><span class="line">        <span class="keyword">this</span>.value = name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> Person(<span class="string">'Tom'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(person.name)</span><br><span class="line">person.name = <span class="string">'Lisa'</span></span><br><span class="line"><span class="built_in">console</span>.log(person.name)</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">getter</span></span><br><span class="line"><span class="comment">Tom</span></span><br><span class="line"><span class="comment">setter</span></span><br><span class="line"><span class="comment">getter</span></span><br><span class="line"><span class="comment">Lisa</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="为类添加生成器方法-定义Symbol-iterator"><a href="#为类添加生成器方法-定义Symbol-iterator" class="headerlink" title="为类添加生成器方法(定义Symbol.iterator)"></a>为类添加生成器方法(定义Symbol.iterator)</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Collection</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">this</span>.items= []</span><br><span class="line">    &#125;</span><br><span class="line">    *[<span class="built_in">Symbol</span>.iterator]()&#123;</span><br><span class="line">        <span class="keyword">yield</span> *<span class="keyword">this</span>.items.values() <span class="comment">//this.items.values()是数组内置的迭代器，这里相当于把this.items的生成器合并在类生成器中了</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> collection = <span class="keyword">new</span> Collection()</span><br><span class="line">collection.items.push(<span class="number">1</span>)</span><br><span class="line">collection.items.push(<span class="number">2</span>)</span><br><span class="line">collection.items.push(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> value <span class="keyword">of</span> collection)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<h4 id="静态成员"><a href="#静态成员" class="headerlink" title="静态成员"></a>静态成员</h4><p>我们之前已经实验过，在类中定义的方法，是把此方法属性加到类的原型上的，类的实例也都继承了这些方法，可以访问；<br>如果不希望实例可以访问，只能被类自身访问，则需要使用静态成员</p>
<h5 id="ES5传统的实现写法"><a href="#ES5传统的实现写法" class="headerlink" title="ES5传统的实现写法"></a>ES5传统的实现写法</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//添加在原型上，所有实例都可以访问</span></span><br><span class="line">Person.prototype.getName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line">静态方法，实例访问不到</span><br><span class="line">Person.sayHi = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hi'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ES6写法"><a href="#ES6写法" class="headerlink" title="ES6写法"></a>ES6写法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//添加到原型上，所有实例都可以访问</span></span><br><span class="line">    getName()&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">this</span>.name </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> sayHi()&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'Hi'</span>) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> person = <span class="keyword">new</span> Person(<span class="string">'Tom'</span>)</span><br><span class="line"><span class="built_in">console</span>.log(person.getName()) <span class="comment">//Tom</span></span><br><span class="line"><span class="comment">// person.sayHi() // 抛出异常 person.sayHi is not a function</span></span><br><span class="line">Person.sayHi()<span class="comment">//Hi</span></span><br></pre></td></tr></table></figure>
<h4 id="使用extends关键词完成类的继承"><a href="#使用extends关键词完成类的继承" class="headerlink" title="使用extends关键词完成类的继承"></a>使用extends关键词完成类的继承</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length, width)&#123;</span><br><span class="line">        <span class="keyword">this</span>.length = length;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">    getArea()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.length * <span class="keyword">this</span>.width</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length)&#123;</span><br><span class="line">        <span class="comment">//使用super()调用父类的构造函数</span></span><br><span class="line">        <span class="keyword">super</span>(length, length)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> square = <span class="keyword">new</span> Square(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">console</span>.log(square.getArea()) <span class="comment">//9</span></span><br><span class="line"><span class="built_in">console</span>.log(square <span class="keyword">instanceof</span> Square) <span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(square <span class="keyword">instanceof</span> Rectangle) <span class="comment">//true</span></span><br></pre></td></tr></table></figure>
<ul>
<li>继承父类的类叫派生类，派生类如果显式定义了构造器，就必须在访问this之前，要显式地使用super()调用父类的构造器，完成父类初始化this，并通过继承传递给派生类，否则在派生类中访问this时会报错</li>
<li><p>在派生类中才可以使用super关键词，指代父类，super()表示先初始化父类的构造器，然后派生类继承父类的this，所以在派生类中this也就可以访问了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>()&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'call parent'</span>)</span><br><span class="line">      <span class="keyword">this</span>.length = <span class="number">10</span></span><br><span class="line">      <span class="keyword">this</span>.width = <span class="number">5</span></span><br><span class="line">  &#125;</span><br><span class="line">  getArea()&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.length * <span class="keyword">this</span>.width</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">      <span class="keyword">constructor</span>()&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'call child1'</span>)</span><br><span class="line">          <span class="keyword">super</span>()</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'call child2'</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      getValue()&#123;</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'length'</span>,<span class="keyword">this</span>.length)</span><br><span class="line">          <span class="built_in">console</span>.log(<span class="string">'width'</span>,<span class="keyword">this</span>.width)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> square = <span class="keyword">new</span> Square()</span><br><span class="line">  square.getValue()</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">  call child1</span></span><br><span class="line"><span class="comment">  call parent</span></span><br><span class="line"><span class="comment">  call child2</span></span><br><span class="line"><span class="comment">  length 10</span></span><br><span class="line"><span class="comment">  width 5</span></span><br><span class="line"><span class="comment">  */</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>如果派生类没有显式定义构造器，则系统在初始化的时候会默认调用super()，并使用创建实例时传递的所有参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等价于</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(..args)&#123;</span><br><span class="line">        <span class="keyword">super</span>(...args)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>注意：如果派生类与父类初始化的参数完全相同，可以选择省略constructor的形式<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length, width)&#123;</span><br><span class="line">        <span class="keyword">this</span>.length = length;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">    getArea()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.length * <span class="keyword">this</span>.width</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> square = <span class="keyword">new</span> Square(<span class="number">3</span>,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">console</span>.log(square.getArea()) <span class="comment">//9</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>如果派生类与父类的初始化参数不一致，就得自己写构造器constructor，手动调用super()，否则会得到意想不到的结果<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(length, width)&#123;</span><br><span class="line">        <span class="keyword">this</span>.length = length;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">    &#125;</span><br><span class="line">    getArea()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.length * <span class="keyword">this</span>.width</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Square</span> <span class="keyword">extends</span> <span class="title">Rectangle</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> square = <span class="keyword">new</span> Square(<span class="number">3</span>) <span class="comment">//这里只传了1个参数，派生类使用默认的构造器传递参数，与父类构造器参数不一致，导致有些参数为undefined，调用计算方法是肯定为NaN</span></span><br><span class="line"><span class="built_in">console</span>.log(square.getArea()) <span class="comment">//NaN</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="静态成员也会被继承"><a href="#静态成员也会被继承" class="headerlink" title="静态成员也会被继承"></a>静态成员也会被继承</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> sayHi()&#123;</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'Hi'</span>) </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">Person.sayHi()<span class="comment">//Hi </span></span><br><span class="line">Student.sayHi()<span class="comment">//Hi</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/02/20/understanding-es6-8/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/20/understanding-es6-8/" class="post-title-link" itemprop="url">ES6-Iterator/Generator</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-20 16:36:10" itemprop="dateCreated datePublished" datetime="2019-02-20T16:36:10+08:00">2019-02-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-04 15:11:16" itemprop="dateModified" datetime="2019-03-04T15:11:16+08:00">2019-03-04</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0qs1z3avzj216w0lggpe.jpg" alt=""></p>
<h3 id="迭代器与生成器"><a href="#迭代器与生成器" class="headerlink" title="迭代器与生成器"></a>迭代器与生成器</h3><h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>传统的遍历迭代集合的方式使用for循环，ES6引入了迭代器对象，使得操作集合更加便捷，Set、Map、for…of、扩展运算符 都用到了迭代器，<strong>注：普通的对象不是可迭代的，因为没有Symbol(Symbol.iterator)属性</strong></p>
<h4 id="迭代器Iterator"><a href="#迭代器Iterator" class="headerlink" title="迭代器Iterator"></a>迭代器Iterator</h4><p>迭代器表示可以被遍历迭代的对象，以编程的方式返回集合中的下一项，迭代器对象都拥有next()方法，返回{value:’’,done:bool},value表示当前迭代位置的返回值，done表示是否迭代结束，结束时其值为false</p>
<h4 id="生成器Generator"><a href="#生成器Generator" class="headerlink" title="生成器Generator"></a>生成器Generator</h4><p>是一个返回迭代器对象的函数</p>
<ol>
<li>使用 function *函数名(){} 来创建生成器</li>
<li>使用生成器函数表达式创建生成器：let iterator = function *(){}  <strong>注：不能使用箭头函数创建生成器</strong></li>
<li>函数体中使用yield关键字定义每次迭代器调用next()返回的value结果，yield指令相当于起到暂停代码执行的作用，只有在迭代器调用next()时，才会触发下一个yield继续执行</li>
<li>迭代完yield后，下一次迭代会返回return的值；如果return放在中间，则迭代到return行后，后面的yield也不会执行了<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">createIterator</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> iterator = createIterator()</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: 3, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: 123, done: true&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="可迭代对象与for…of"><a href="#可迭代对象与for…of" class="headerlink" title="可迭代对象与for…of"></a>可迭代对象与for…of</h3><h4 id="可迭代对象-iterable-是指带Symbol-Symbol-iterator-属性的对象，Symbol-Symbol-iterator-本质上是一个生成器函数，所有的集合对象-数组、Set、Map-及字符串的原型上都默认携带这个属性，因此都是可迭代对象"><a href="#可迭代对象-iterable-是指带Symbol-Symbol-iterator-属性的对象，Symbol-Symbol-iterator-本质上是一个生成器函数，所有的集合对象-数组、Set、Map-及字符串的原型上都默认携带这个属性，因此都是可迭代对象" class="headerlink" title="可迭代对象(iterable)是指带Symbol(Symbol.iterator)属性的对象，Symbol(Symbol.iterator) 本质上是一个生成器函数，所有的集合对象(数组、Set、Map)及字符串的原型上都默认携带这个属性，因此都是可迭代对象"></a>可迭代对象(iterable)是指带Symbol(Symbol.iterator)属性的对象，Symbol(Symbol.iterator) 本质上是一个生成器函数，所有的集合对象(数组、Set、Map)及字符串的原型上都默认携带这个属性，因此都是可迭代对象</h4><p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0d6x83uz6j211u0naq6h.jpg" alt=""></p>
<h4 id="可迭代对象可以使用ES6新增的for-of方法遍历"><a href="#可迭代对象可以使用ES6新增的for-of方法遍历" class="headerlink" title="可迭代对象可以使用ES6新增的for-of方法遍历"></a>可迭代对象可以使用ES6新增的for-of方法遍历</h4><p>for-of的优势：使用传统for循环时，需要通过逻辑控制遍历条件，特别是多级嵌套时会导致复杂度增加，容易出错<br>for-of循环的原理：</p>
<ol>
<li>首先内部会自动调用集合的Symbol.iterator方法，获取到默认的迭代器对象</li>
<li>然后在每次循环时，都会自动调迭代器的next()，将返回结果对象的value值赋给临时变量上(迭代器返回的结果对象的value就是可迭代对象上定义的值)</li>
<li>下一轮循环继续调用next()，直到遇到返回的结果对象的done属性值为true，停止遍历<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">let</span> iterator = arr[<span class="built_in">Symbol</span>.iterator]()</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next()) <span class="comment">//&#123;value: 3, done: false&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="创建可迭代对象"><a href="#创建可迭代对象" class="headerlink" title="创建可迭代对象"></a>创建可迭代对象</h3><p>因为我们正常创建的对象是没有Symbol.iterator属性的，所以是不可迭代的。我们可以自定义一个Symbol.iterator属性<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    items:[],</span><br><span class="line">    *[<span class="built_in">Symbol</span>.iterator]()&#123; <span class="comment">//使用Symbol类型要使用[]</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">let</span> item <span class="keyword">of</span> <span class="keyword">this</span>.items)&#123;</span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.items.push(<span class="number">1</span>)</span><br><span class="line">obj.items.push(<span class="number">2</span>)</span><br><span class="line">obj.items.push(<span class="number">3</span>)</span><br><span class="line"><span class="built_in">console</span>.log(obj) <span class="comment">// &#123;items: Array(3), Symbol(Symbol.iterator): ƒ&#125;</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> value <span class="keyword">of</span> obj)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value) <span class="comment">//1,2,3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="集合内置的迭代器"><a href="#集合内置的迭代器" class="headerlink" title="集合内置的迭代器"></a>集合内置的迭代器</h3><p>ES6具有内置迭代器的集合对象类型：数组、Set、Map</p>
<ul>
<li>entries():返回一个包含键值对的迭代器，迭代返回的结果对象value是键值对数组</li>
<li>values():返回一个包含集合中的值的迭代器</li>
<li>keys():返回一个包含集合中的键的迭代器<h4 id="在for-of中使用上面三种的其中一种都可以，下面是显式指定迭代器的写法："><a href="#在for-of中使用上面三种的其中一种都可以，下面是显式指定迭代器的写法：" class="headerlink" title="在for-of中使用上面三种的其中一种都可以，下面是显式指定迭代器的写法："></a>在for-of中使用上面三种的其中一种都可以，下面是显式指定迭代器的写法：</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> colors = [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>]</span><br><span class="line"><span class="keyword">let</span> tracking = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">123</span>,<span class="number">456</span>,<span class="number">789</span>])</span><br><span class="line"><span class="keyword">let</span> data = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line"></span><br><span class="line">data.set(<span class="string">'title'</span>,<span class="string">'understanding ES6'</span>)</span><br><span class="line">data.set(<span class="string">'format'</span>, <span class="string">'ebook'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> entry <span class="keyword">of</span> colors.entries())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(entry)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> entry <span class="keyword">of</span> tracking.entries())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(entry)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> entry <span class="keyword">of</span> data.entries())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(entry)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">[0, "red"]</span></span><br><span class="line"><span class="comment">[1, "green"]</span></span><br><span class="line"><span class="comment">[2, "blue"]</span></span><br><span class="line"><span class="comment">[123, 123]</span></span><br><span class="line"><span class="comment">[456, 456]</span></span><br><span class="line"><span class="comment">[789, 789]</span></span><br><span class="line"><span class="comment">["title", "understanding ES6"]</span></span><br><span class="line"><span class="comment">["format", "ebook"]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> value <span class="keyword">of</span> colors.values())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> value <span class="keyword">of</span> tracking.values())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> value <span class="keyword">of</span> data.values())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">red</span></span><br><span class="line"><span class="comment">green</span></span><br><span class="line"><span class="comment">blue</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">789</span></span><br><span class="line"><span class="comment">understanding ES6</span></span><br><span class="line"><span class="comment">ebook</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">of</span> colors.keys())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">of</span> tracking.keys())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">of</span> data.keys())&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">0</span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">2</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">789</span></span><br><span class="line"><span class="comment">title</span></span><br><span class="line"><span class="comment">format</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="三种几个类型默认的迭代器是什么呢？"><a href="#三种几个类型默认的迭代器是什么呢？" class="headerlink" title="三种几个类型默认的迭代器是什么呢？"></a>三种几个类型默认的迭代器是什么呢？</h4><p>当都有for-of循环没有显式指定迭代器时，每种集合类型都有一个默认的迭代器供循环调用</p>
<ul>
<li>values():数组与Set的默认迭代器</li>
<li>entries():Map的默认迭代器<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> colors = [<span class="string">'red'</span>, <span class="string">'green'</span>, <span class="string">'blue'</span>]</span><br><span class="line"><span class="keyword">let</span> tracking = <span class="keyword">new</span> <span class="built_in">Set</span>([<span class="number">123</span>,<span class="number">456</span>,<span class="number">789</span>])</span><br><span class="line"><span class="keyword">let</span> data = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line"></span><br><span class="line">data.set(<span class="string">'title'</span>,<span class="string">'understanding ES6'</span>)</span><br><span class="line">data.set(<span class="string">'format'</span>, <span class="string">'ebook'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//与使用colors.values()相同</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> value <span class="keyword">of</span> colors)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">red</span></span><br><span class="line"><span class="comment">green</span></span><br><span class="line"><span class="comment">blue</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//与使用tracking.values()相同</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> value <span class="keyword">of</span> tracking)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">123</span></span><br><span class="line"><span class="comment">456</span></span><br><span class="line"><span class="comment">789</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//与使用data.entries()相同</span></span><br><span class="line"><span class="comment">//使用了数组解构，方便操作迭代器返回的结果对象[0, "red"]格式</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> [key,value] <span class="keyword">of</span> data)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(key + <span class="string">' '</span> + value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">title understanding ES6</span></span><br><span class="line"><span class="comment">format ebook</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="NodeList的迭代器"><a href="#NodeList的迭代器" class="headerlink" title="NodeList的迭代器"></a>NodeList的迭代器</h3><p>使用document.getElementsByXXX获取的文档对象模型(DOM)是一种NodeList类型，其比较大的特点是，有类似数组的length属性，同时具有默认迭代器，因此NodeList可以使用for-of迭代</p>
<h3 id="扩展运算符"><a href="#扩展运算符" class="headerlink" title="扩展运算符"></a>扩展运算符</h3><p>扩展运算符可以应用到任何可迭代的集合上，扩展运算符会调用默认的迭代器，返回相应的结果对象value值</p>
<h3 id="生成器委托：可以将多个生成器合并到一起"><a href="#生成器委托：可以将多个生成器合并到一起" class="headerlink" title="生成器委托：可以将多个生成器合并到一起"></a>生成器委托：可以将多个生成器合并到一起</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">numberIterator</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">colorIterator</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'red'</span>;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'blue'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">combinedInterator</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">yield</span> *numberIterator();</span><br><span class="line">    <span class="keyword">yield</span> *colorIterator();</span><br><span class="line">    <span class="keyword">yield</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> interator = combinedInterator()</span><br><span class="line"><span class="built_in">console</span>.log(interator.next()) <span class="comment">//&#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(interator.next()) <span class="comment">//&#123;value: 2, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(interator.next()) <span class="comment">//&#123;value: "red", done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(interator.next()) <span class="comment">//&#123;value: "blue", done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(interator.next()) <span class="comment">//&#123;value: true, done: false&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(interator.next()) <span class="comment">//&#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="传递参数给迭代器"><a href="#传递参数给迭代器" class="headerlink" title="传递参数给迭代器"></a>传递参数给迭代器</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">createIterator</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> first = <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'first'</span>,first)</span><br><span class="line">    <span class="keyword">let</span> second = <span class="keyword">yield</span> first *<span class="number">3</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'second'</span>,second)</span><br><span class="line">    <span class="keyword">yield</span> second * <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> iterator = createIterator()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next(<span class="number">3</span>)) <span class="comment">//第一个next()中的参数不起作用</span></span><br><span class="line"><span class="built_in">console</span>.log(iterator.next(<span class="number">2</span>))</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next(<span class="number">4</span>))</span><br><span class="line"><span class="built_in">console</span>.log(iterator.next())</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">&#123;value: 1, done: false&#125;</span></span><br><span class="line"><span class="comment">first 2</span></span><br><span class="line"><span class="comment">&#123;value: 6, done: false&#125;</span></span><br><span class="line"><span class="comment">second 4</span></span><br><span class="line"><span class="comment">&#123;value: 20, done: false&#125;</span></span><br><span class="line"><span class="comment">&#123;value: undefined, done: true&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>
<ol>
<li>执行第一个next(),第一个next()比较特殊，传进来的参数被忽略</li>
<li>执行完第一个’yield 1’后，代码被暂停</li>
<li>执行第二个next(),next()中传递的参数2作为’let first = yield 1’中的返回值，赋值给first变量，所以运行’yield first *3’的结果是2x3=6</li>
<li>执行第三个next(),next()中传递的参数4作为second的值，以此类推</li>
</ol>
<h3 id="使用生成器、迭代器实现异步任务运行"><a href="#使用生成器、迭代器实现异步任务运行" class="headerlink" title="使用生成器、迭代器实现异步任务运行"></a>使用生成器、迭代器实现异步任务运行</h3><p>执行异步任务的传统方法是创建一个带有回调的函数，可以很完美的解决数量比较少的任务；但是如果有多层嵌套回调，或者按顺序执行一系列任务时，使用生成器和迭代器可以完成异步任务的实现，yield指令可以起到很好暂停代码执行的作用</p>
<ol>
<li>创建一个调用生成器并启动迭代器的函数</li>
<li>调用该函数，传入期望执行任务的生成器<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">taskDef</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//调用生成器，得到迭代器</span></span><br><span class="line">    <span class="keyword">let</span> task = taskDef()</span><br><span class="line">     <span class="comment">//启动任务</span></span><br><span class="line">    <span class="keyword">let</span> result = task.next()</span><br><span class="line">    <span class="comment">// 使用递归 保证迭代器的调用</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">step</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!result.done)&#123;</span><br><span class="line">            result = task.next()</span><br><span class="line">            step()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//开始处理</span></span><br><span class="line">    step()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> run(<span class="function"><span class="keyword">function</span>*(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">     <span class="keyword">yield</span>;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">     <span class="keyword">yield</span>;</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line"> &#125;)</span><br><span class="line"> <span class="comment">/*</span></span><br><span class="line"><span class="comment"> 1</span></span><br><span class="line"><span class="comment"> 2</span></span><br><span class="line"><span class="comment"> 3</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
</li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/02/20/understanding-es6-7/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/20/understanding-es6-7/" class="post-title-link" itemprop="url">ES6-Set/Map</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-20 14:50:33" itemprop="dateCreated datePublished" datetime="2019-02-20T14:50:33+08:00">2019-02-20</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-04 15:11:12" itemprop="dateModified" datetime="2019-03-04T15:11:12+08:00">2019-03-04</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0qs1z3avzj216w0lggpe.jpg" alt=""></p>
<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>ES6新增了两种集合类型Set、Map，用来实现不同的功能</p>
<ul>
<li>Set 是不包含重复值的列表，常被用来检查某个值是否存在</li>
<li>Map 是键值对的集合，多用来作为缓存，存储和提取数据。Object的属性类型都会默认转成字符串，比如obj[‘5’]与obj[5]是等价的；Map的属性类型可以其他类型</li>
</ul>
<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><ol>
<li>new Set()创建Set类型</li>
<li>add()向Set中添加新的元素</li>
<li>size属性返回当前Set列表包含几个元素</li>
<li>has()判断当前调用的Set是否包含某个值</li>
<li>delete()删除指定元素</li>
<li>clear()清空当前Set列表</li>
<li>Set不会对元素做强制类型转换，比如5与’5’是两个不同的元素</li>
<li>Set列表不存在索引，所以无法像数组一样通过索引获取某一个值，可以使用forEach()依次遍历列表中的元素</li>
<li>对于只想存储对象类型元素的列表，并且担心Set列表中的对象强引用造成内存泄漏等问题，建议使用new WeakSet()创建弱引用的Set列表，要求所有元素必须为对象类型，否则会报错。当Weak Set中的对象在Weak Set之外不存在任何引用时，该对象就会被销毁，也就不会存在干扰垃圾回收，内存泄漏的问题(与传统的Set用法还有些区别，感兴趣的可以自己进一步了解下)<h4 id="将数组转换成Set，可以删除掉重复的元素"><a href="#将数组转换成Set，可以删除掉重复的元素" class="headerlink" title="将数组转换成Set，可以删除掉重复的元素"></a>将数组转换成Set，可以删除掉重复的元素</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(arr)</span><br><span class="line"><span class="built_in">console</span>.log(set) <span class="comment">// Set(5) &#123;1, 2, 3, 4, 5&#125;</span></span><br><span class="line">set.forEach(<span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value) <span class="comment">// 1,2,3,4,5</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h4 id="将Set转换成数组，使用扩展运算符"><a href="#将Set转换成数组，使用扩展运算符" class="headerlink" title="将Set转换成数组，使用扩展运算符"></a>将Set转换成数组，使用扩展运算符</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">5</span>,<span class="number">4</span>]</span><br><span class="line"><span class="keyword">let</span> set = <span class="keyword">new</span> <span class="built_in">Set</span>(arr)</span><br><span class="line"><span class="keyword">let</span> array = [...set]</span><br><span class="line"><span class="built_in">console</span>.log(array) <span class="comment">// [1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure>
<h4 id="常用来删除数组重复数组的方法"><a href="#常用来删除数组重复数组的方法" class="headerlink" title="常用来删除数组重复数组的方法"></a>常用来删除数组重复数组的方法</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[...new <span class="built_in">Set</span>(array)]</span><br></pre></td></tr></table></figure>
<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p>Map类型是键值对的有序列表，键和值可以为任何类型，特别是对键的类型不会强制转换(内部管理键的值是使用Object.is()全等于的方式，因此5与’5’是两个不同的键)</p>
<ol>
<li>new Map()创建Map列表</li>
<li>set(key,value)创建键值对</li>
<li>get(key)索引键值</li>
<li><p>使用对象作为键，每一个不同的对象实例都不相等 Object.is({},{}) //false</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Object</span>.is(&#123;&#125;,&#123;&#125;) <span class="comment">//false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>(),</span><br><span class="line">    key1 = &#123;&#125;,</span><br><span class="line">    key2 = &#123;&#125;;</span><br><span class="line"> map.set(key1, <span class="string">'Tome'</span>);</span><br><span class="line"> map.set(key2,<span class="string">'1234'</span>);</span><br><span class="line"> <span class="built_in">console</span>.log(map.get(key1)) <span class="comment">//Tom</span></span><br><span class="line"> <span class="built_in">console</span>.log(map.get(key2)) <span class="comment">// 1234</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>has(key) 判断Map列表是否存在该键值对</p>
</li>
<li>delete(key) 删除对应的键值对</li>
<li>clear() 清空本Map列表</li>
<li>size属性，返回Map列表内有几个键值对</li>
<li>new WeakMap() 创建弱引用Map，当Weak Map中键在Weak Map之外不存在任何引用时，该对象就会被销毁<h4 id="Map初始化数组"><a href="#Map初始化数组" class="headerlink" title="Map初始化数组"></a>Map初始化数组</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">'name'</span>,<span class="string">'Tom'</span>],[<span class="string">'age'</span>,<span class="number">20</span>],[<span class="number">3</span>,<span class="number">99</span>]]) <span class="comment">// 数组中有多个含有两个子元素的子数组，子数组中第一个元素作为Map列表的key，第二个值作为Map列表的value</span></span><br><span class="line"><span class="built_in">console</span>.log(map.size) <span class="comment">//3</span></span><br><span class="line"><span class="built_in">console</span>.log(map.get(<span class="string">'name'</span>)) <span class="comment">//Tom</span></span><br><span class="line"><span class="built_in">console</span>.log(map.get(<span class="string">'age'</span>)) <span class="comment">//20</span></span><br><span class="line"><span class="built_in">console</span>.log(map.get(<span class="number">3</span>)) <span class="comment">//99</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>forEach(value, key, ownerMap)方法</p>
<ul>
<li>value 当前位置键值对的值</li>
<li>key 当前位置键值对的键</li>
<li>ownerMap 被调用的Map列表<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">map.forEach(<span class="function">(<span class="params">value, key, ownerMap</span>)=&gt;</span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(key + <span class="string">' '</span> + value)</span><br><span class="line"><span class="built_in">console</span>.log(ownerMap === map)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">name Tome</span><br><span class="line"><span class="literal">true</span></span><br><span class="line">age <span class="number">20</span></span><br><span class="line"><span class="literal">true</span></span><br><span class="line"><span class="number">3</span> <span class="number">99</span></span><br><span class="line"><span class="literal">true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://huanchong.top/2019/02/19/understanding-es6-6/"/>

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Huanchong Zhang"/>
      <meta itemprop="description" content=""/>
      <meta itemprop="image" content="/images/avatar.gif"/>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Huanchong's Blog"/>
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/19/understanding-es6-6/" class="post-title-link" itemprop="url">ES6-Symbol类型</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-19 21:32:28" itemprop="dateCreated datePublished" datetime="2019-02-19T21:32:28+08:00">2019-02-19</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-04 15:11:06" itemprop="dateModified" datetime="2019-03-04T15:11:06+08:00">2019-03-04</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="https://ws1.sinaimg.cn/large/e4d30300ly1g0qs1z3avzj216w0lggpe.jpg" alt=""></p>
<h3 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h3><p>Symbol是JS新引入的一个基本类型，拓宽了定义对象属性的类型(传统的对象是所有属性都是字符串，如今新增了symbol类型的属性)，同时定义对象属性是不可枚举，通过Object.keys()\Object.getOwnPropertyNames()两种方法是访问不到对象的symbol类型属性的，使得对象属性及值的访问更加的安全</p>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><ol>
<li>使用全局Symbol函数创建symbol类型<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> firstName = <span class="built_in">Symbol</span>(<span class="string">'first name'</span>) <span class="comment">//传入的参数作为symbol变量的描述</span></span><br><span class="line"><span class="keyword">let</span> person = &#123;&#125;</span><br><span class="line">person[firstName] = <span class="string">'Tom'</span></span><br><span class="line"><span class="built_in">console</span>.log(person) <span class="comment">// &#123;Symbol(first name): "Tom"&#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(person[firstName]) <span class="comment">// 'Tom'</span></span><br><span class="line"><span class="built_in">console</span>.log(firstName) <span class="comment">// Symbol('first name') symbol变量的描述信息存储在内部属性[[Description]]中，只有显式或隐式的调用toSting()时，会被读取到，console.log()会隐式的调用toString()方法，所以才打印出来了；String(firstName) 也会隐式调用toSting()、firstName.toString()则是显式调用</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'first name'</span> <span class="keyword">in</span> person) <span class="comment">// false  'first name'只是symbol变量的描述信息而已</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>注：<strong>symbol变量最大的特点是不会被转换成字符串和数字类型，所以也就保证了symbol值的唯一性和安全性</strong></p>
<ol start="2">
<li>ES6新定义的Object.getOwnPropertySymbols()检索symbol类型的对象属性<br>Object.keys()\Object.getOwnPropertyNames()两种方法是访问不到对象的symbol类型属性</li>
</ol>
<h3 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h3><p>由于目前使用的场景还不多，所以这里不赘述过多，感兴趣的同学可以去网上查查更多的用法</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Huanchong Zhang</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">23</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">7</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/haunchong" title="GitHub &rarr; https://github.com/haunchong" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:huanchong@gmail.com" title="E-Mail &rarr; mailto:huanchong@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    <iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=523042017&auto=1&height=66"></iframe>
    </div>

  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  
  <span class="author" itemprop="copyrightHolder">Huanchong Zhang</span>

  

  
</div>









        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=6.7.0"></script>




  

  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  




  





  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
